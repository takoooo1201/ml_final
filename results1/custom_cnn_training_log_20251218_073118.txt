Logging to results/custom_cnn_training_log_20251218_073118.txt
Using device: cuda
Loading data...
Dataset sizes: Train=4002, Val=998, Test=1000
Number of classes: 4
Initializing custom_cnn...
Starting training...
Using 2 GPUs!
Epoch 1: Train Loss: 1.0605 Acc: 0.5650 F1: 0.5564
Epoch 1: Val Loss: 0.9060 Acc: 0.6433 F1: 0.5779
Validation loss decreased (inf --> 0.905969).  Saving model ...
Epoch 2: Train Loss: 0.7268 Acc: 0.7081 F1: 0.7034
Epoch 2: Val Loss: 0.6245 Acc: 0.7575 F1: 0.7557
Validation loss decreased (0.905969 --> 0.624509).  Saving model ...
Epoch 3: Train Loss: 0.5665 Acc: 0.7824 F1: 0.7794
Epoch 3: Val Loss: 0.5318 Acc: 0.8176 F1: 0.8195
Validation loss decreased (0.624509 --> 0.531784).  Saving model ...
Epoch 4: Train Loss: 0.4771 Acc: 0.8108 F1: 0.8096
Epoch 4: Val Loss: 0.4327 Acc: 0.8567 F1: 0.8549
Validation loss decreased (0.531784 --> 0.432679).  Saving model ...
Epoch 5: Train Loss: 0.4210 Acc: 0.8326 F1: 0.8308
Epoch 5: Val Loss: 0.3979 Acc: 0.8527 F1: 0.8503
Validation loss decreased (0.432679 --> 0.397902).  Saving model ...
Epoch 6: Train Loss: 0.3640 Acc: 0.8573 F1: 0.8564
Epoch 6: Val Loss: 0.3474 Acc: 0.8768 F1: 0.8754
Validation loss decreased (0.397902 --> 0.347421).  Saving model ...
Epoch 7: Train Loss: 0.3222 Acc: 0.8778 F1: 0.8770
Epoch 7: Val Loss: 0.3219 Acc: 0.8818 F1: 0.8816
Validation loss decreased (0.347421 --> 0.321869).  Saving model ...
Epoch 8: Train Loss: 0.3048 Acc: 0.8816 F1: 0.8814
Epoch 8: Val Loss: 0.3020 Acc: 0.8928 F1: 0.8923
Validation loss decreased (0.321869 --> 0.302009).  Saving model ...
Epoch 9: Train Loss: 0.2774 Acc: 0.8953 F1: 0.8948
Epoch 9: Val Loss: 0.2926 Acc: 0.8998 F1: 0.8992
Validation loss decreased (0.302009 --> 0.292565).  Saving model ...
Epoch 10: Train Loss: 0.2606 Acc: 0.9018 F1: 0.9013
Epoch 10: Val Loss: 0.2906 Acc: 0.8918 F1: 0.8908
Validation loss decreased (0.292565 --> 0.290572).  Saving model ...
Epoch 11: Train Loss: 0.3022 Acc: 0.8823 F1: 0.8818
Epoch 11: Val Loss: 0.2885 Acc: 0.8958 F1: 0.8959
Validation loss decreased (0.290572 --> 0.288520).  Saving model ...
Epoch 12: Train Loss: 0.2551 Acc: 0.9003 F1: 0.8999
Epoch 12: Val Loss: 0.2460 Acc: 0.9088 F1: 0.9094
Validation loss decreased (0.288520 --> 0.246047).  Saving model ...
Epoch 13: Train Loss: 0.2412 Acc: 0.9088 F1: 0.9086
Epoch 13: Val Loss: 0.2360 Acc: 0.9058 F1: 0.9049
Validation loss decreased (0.246047 --> 0.235967).  Saving model ...
Epoch 14: Train Loss: 0.1963 Acc: 0.9223 F1: 0.9220
Epoch 14: Val Loss: 0.1992 Acc: 0.9279 F1: 0.9275
Validation loss decreased (0.235967 --> 0.199152).  Saving model ...
Epoch 15: Train Loss: 0.1664 Acc: 0.9340 F1: 0.9340
Epoch 15: Val Loss: 0.1881 Acc: 0.9289 F1: 0.9290
Validation loss decreased (0.199152 --> 0.188066).  Saving model ...
Epoch 16: Train Loss: 0.1350 Acc: 0.9493 F1: 0.9492
Epoch 16: Val Loss: 0.1939 Acc: 0.9309 F1: 0.9308
EarlyStopping counter: 1 out of 7
Epoch 17: Train Loss: 0.1144 Acc: 0.9573 F1: 0.9572
Epoch 17: Val Loss: 0.1708 Acc: 0.9389 F1: 0.9387
Validation loss decreased (0.188066 --> 0.170843).  Saving model ...
Epoch 18: Train Loss: 0.1013 Acc: 0.9610 F1: 0.9609
Epoch 18: Val Loss: 0.1729 Acc: 0.9379 F1: 0.9377
EarlyStopping counter: 1 out of 7
Epoch 19: Train Loss: 0.0931 Acc: 0.9705 F1: 0.9705
Epoch 19: Val Loss: 0.1616 Acc: 0.9469 F1: 0.9469
Validation loss decreased (0.170843 --> 0.161610).  Saving model ...
Epoch 20: Train Loss: 0.0879 Acc: 0.9695 F1: 0.9695
Epoch 20: Val Loss: 0.1604 Acc: 0.9449 F1: 0.9449
Validation loss decreased (0.161610 --> 0.160441).  Saving model ...
Epoch 21: Train Loss: 0.1554 Acc: 0.9410 F1: 0.9410
Epoch 21: Val Loss: 0.1782 Acc: 0.9469 F1: 0.9468
EarlyStopping counter: 1 out of 7
Epoch 22: Train Loss: 0.1334 Acc: 0.9525 F1: 0.9525
Epoch 22: Val Loss: 0.1644 Acc: 0.9439 F1: 0.9438
EarlyStopping counter: 2 out of 7
Epoch 23: Train Loss: 0.1010 Acc: 0.9620 F1: 0.9620
Epoch 23: Val Loss: 0.1506 Acc: 0.9489 F1: 0.9490
Validation loss decreased (0.160441 --> 0.150636).  Saving model ...
Epoch 24: Train Loss: 0.0800 Acc: 0.9730 F1: 0.9730
Epoch 24: Val Loss: 0.1531 Acc: 0.9569 F1: 0.9571
EarlyStopping counter: 1 out of 7
Epoch 25: Train Loss: 0.0681 Acc: 0.9788 F1: 0.9788
Epoch 25: Val Loss: 0.1879 Acc: 0.9439 F1: 0.9437
EarlyStopping counter: 2 out of 7
Epoch 26: Train Loss: 0.0650 Acc: 0.9758 F1: 0.9758
Epoch 26: Val Loss: 0.1318 Acc: 0.9569 F1: 0.9568
Validation loss decreased (0.150636 --> 0.131776).  Saving model ...
Epoch 27: Train Loss: 0.0457 Acc: 0.9855 F1: 0.9855
Epoch 27: Val Loss: 0.1399 Acc: 0.9619 F1: 0.9619
EarlyStopping counter: 1 out of 7
Epoch 28: Train Loss: 0.0371 Acc: 0.9893 F1: 0.9893
Epoch 28: Val Loss: 0.1256 Acc: 0.9629 F1: 0.9629
Validation loss decreased (0.131776 --> 0.125589).  Saving model ...
Epoch 29: Train Loss: 0.0288 Acc: 0.9925 F1: 0.9925
Epoch 29: Val Loss: 0.1169 Acc: 0.9669 F1: 0.9670
Validation loss decreased (0.125589 --> 0.116881).  Saving model ...
Epoch 30: Train Loss: 0.0269 Acc: 0.9943 F1: 0.9943
Epoch 30: Val Loss: 0.1179 Acc: 0.9669 F1: 0.9670
EarlyStopping counter: 1 out of 7
Epoch 31: Train Loss: 0.0603 Acc: 0.9800 F1: 0.9800
Epoch 31: Val Loss: 0.1441 Acc: 0.9529 F1: 0.9528
EarlyStopping counter: 2 out of 7
Epoch 32: Train Loss: 0.0669 Acc: 0.9775 F1: 0.9775
Epoch 32: Val Loss: 0.1422 Acc: 0.9529 F1: 0.9526
EarlyStopping counter: 3 out of 7
Epoch 33: Train Loss: 0.0596 Acc: 0.9795 F1: 0.9795
Epoch 33: Val Loss: 0.1387 Acc: 0.9539 F1: 0.9537
EarlyStopping counter: 4 out of 7
Epoch 34: Train Loss: 0.0475 Acc: 0.9843 F1: 0.9842
Epoch 34: Val Loss: 0.1217 Acc: 0.9609 F1: 0.9611
EarlyStopping counter: 5 out of 7
Epoch 35: Train Loss: 0.0326 Acc: 0.9900 F1: 0.9900
Epoch 35: Val Loss: 0.1187 Acc: 0.9669 F1: 0.9671
EarlyStopping counter: 6 out of 7
Epoch 36: Train Loss: 0.0263 Acc: 0.9913 F1: 0.9913
Epoch 36: Val Loss: 0.1241 Acc: 0.9629 F1: 0.9629
EarlyStopping counter: 7 out of 7
Early stopping
Starting robustness test...
Evaluating on Clean Test Set...
Evaluating Gaussian Noise (sigma=0.1)...
Evaluating Gaussian Noise (sigma=0.5)...
Evaluating Gaussian Noise (sigma=1.0)...
Evaluating Blur (kernel=3)...
Evaluating Blur (kernel=5)...
Evaluating Blur (kernel=7)...
Evaluating Contrast (factor=0.5)...
Evaluating Contrast (factor=0.8)...
Results saved to results/custom_cnn_robustness_results.csv
        Condition   Parameter  Accuracy  F1-Score  Acc Drop   F1 Drop
0           Clean        None     0.971  0.970949     0.000  0.000000
1  Gaussian Noise   sigma=0.1     0.969  0.968933     0.002  0.002016
2  Gaussian Noise   sigma=0.5     0.920  0.918292     0.051  0.052657
3  Gaussian Noise   sigma=1.0     0.744  0.719454     0.227  0.251496
4            Blur         k=3     0.966  0.965944     0.005  0.005005
5            Blur         k=5     0.962  0.961909     0.009  0.009041
6            Blur         k=7     0.960  0.959870     0.011  0.011079
7        Contrast  factor=0.5     0.731  0.702341     0.240  0.268609
8        Contrast  factor=0.8     0.930  0.929355     0.041  0.041595
